#{extends 'main.html' /}
#{set title:'Home' /}

#{if flash.success}
    <p class="success">${flash.success}</p>
#{/if}

#{if game}
    <script type="text/javascript">
        var gameId = ${game.id};
        var size = ${game.board.size};

        $(document).ready( function()
        {
            var canvas = $("#canvas");
            var myGame = game(canvas, size, gameId);

            board.setPositionsFromString("${game.board.positions}");
            myGame.draw(canvas)


            canvas.mousemove(
                    function(e) {
                        pos = getCursorPosition(this, e);
                    }).mouseup(function(e) {
                        pos = getCursorPosition(this, e);
                        myGame.play(pos);
                    });


            function getCursorPosition(canvas, event) {
                var x, y;
                canoffset = $(canvas).offset();
                x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - Math.floor(canoffset.left);
                y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - Math.floor(canoffset.top) + 1;
                return [x,y];
            }
        });

    </script>
    <div class="game">

        ${game.board.positions}

    <div id="debugger"></div>
    <div id="ajax">

    </div>
    <div id="scoreboard">
     <div id="black">
         Black : <span id="blackPoints"> 0 </span> points
     </div>
     <div id="turn">
         <span id="playerTurn">Black's</span> turn
     </div>
     <div id="white">
         White : <span id="whitePoints"> 0 </span> points
     </div>

    </div>
    <div id="error">
        #{if flash.error}
            <p class="error">${flash.error}</p>
        #{/if}
    </div>
    <div id="board">
        <canvas width="950" height="950" id="canvas"/>
    </div>

    </canvas>

    </div>
  #{/if}

link for player 1: <a href="@{Application.show(game.id)}">Player 1</a>
link for player 2: <a href="@{Application.show(game.id)}">Player 2</a>
${game.player2URL}
